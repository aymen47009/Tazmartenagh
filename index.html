<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0d9488" />
    <title>ุชุณููุฑ ูุฎุฒูู ุงูุนุชุงุฏ - PWA</title>
    <base href="./">
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="icons/icon-192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  </head>
  <body>
    <header class="app-header">
      <div class="brand">
        <span class="logo">๐ฅ</span>
        <span>ุชุณููุฑ ูุฎุฒูู ุงูุนุชุงุฏ</span>
      </div>
      <nav class="top-actions">
        <button id="installBtn" class="btn secondary" hidden>ุชุซุจูุช ุงูุชุทุจูู</button>
        <button id="logoutBtn" class="btn danger" hidden>ุชุณุฌูู ุงูุฎุฑูุฌ</button>
      </nav>
    </header>

    <main id="app" class="container">
      <!-- Login View -->
      <section id="view-login" class="view">
        <h1>ูุฑุญุจูุง ุจู</h1>
        <p class="muted">ุฏุฎูู ููุญุฏ ูุฌููุน ุงูุฃุนุถุงุก</p>
        <form id="loginForm" class="card">
          <label class="field">
            <span>ุฑูุฒ ุงูุฏุฎูู</span>
            <input id="loginCode" type="password" inputmode="numeric" autocomplete="one-time-code" placeholder="โขโขโขโข" required />
          </label>
          <button class="btn primary" type="submit">ุฏุฎูู</button>
        </form>
      </section>

      <!-- Shell (visible after login) -->
      <section id="view-shell" class="view hidden">
        <div class="tabs">
          <button data-route="inventory" class="tab active">ุงููุฎุฒูู</button>
          <button data-route="loans" class="tab">ุงูุณูููุงุช</button>
          <button data-route="returns" class="tab">ุงูุฅุฑุฌุงุนุงุช</button>
          <button data-route="reports" class="tab">ุงูุชูุงุฑูุฑ</button>
        </div>

        <div id="route-inventory" class="route">
          <div class="toolbar">
            <button id="addItemBtn" class="btn primary">ุฅุถุงูุฉ ุนุชุงุฏ</button>
            <div class="spacer"></div>
            <input id="inventorySearch" class="input" placeholder="ุจุญุซ ุจุงุณู ุงูุนุชุงุฏ" />
          </div>
          <div class="list" id="inventoryList"></div>

          <!-- Add/Edit Item Modal -->
          <dialog id="itemDialog" class="dialog">
            <form method="dialog" id="itemForm">
              <h3 id="itemDialogTitle">ุฅุถุงูุฉ ุนุชุงุฏ</h3>
              <div class="grid-2">
                <label class="field">
                  <span>ุงุณู ุงูุนุชุงุฏ</span>
                  <input id="f_name" required />
                </label>
                <label class="field">
                  <span>ุงููููุฉ ุงูุฃุตููุฉ</span>
                  <input id="f_initialQty" type="number" min="0" step="1" required />
                </label>
                <label class="field">
                  <span>ุงููููุฉ ุงููููุฉ</span>
                  <input id="f_totalQty" type="number" min="0" step="1" required />
                </label>
                <label class="field">
                  <span>ุงูููุงุญุธุงุช</span>
                  <input id="f_notes" />
                </label>
              </div>

              <div class="qr-row">
                <button id="genQrBtn" class="btn">ุชูููุฏ QR</button>
                <button id="scanQrBtn" class="btn">ูุณุญ QR</button>
              </div>
              <div id="qrContainer" class="qr"></div>
              <div id="scanContainer" class="scan hidden">
                <video id="scanVideo" playsinline></video>
                <button id="stopScanBtn" class="btn danger small" type="button">ุฅููุงู ุงููุณุญ</button>
              </div>

              <menu class="dialog-actions">
                <button id="deleteItemBtn" class="btn danger" value="delete" type="button">ุญุฐู</button>
                <div class="spacer"></div>
                <button class="btn" value="cancel">ุฅูุบุงุก</button>
                <button class="btn primary" value="ok">ุญูุธ</button>
              </menu>
            </form>
          </dialog>
        </div>

        <div id="route-loans" class="route hidden">
          <form id="loanForm" class="card">
            <h3>ุฅุถุงูุฉ ุณูู</h3>
            <div class="grid-2">
              <label class="field">
                <span>ุงุณู ุงูุนุชุงุฏ</span>
                <input id="loan_item" list="itemsDatalist" required />
                <datalist id="itemsDatalist"></datalist>
              </label>
              <label class="field">
                <span>ุงููููุฉ ุงููุณููููุฉ</span>
                <input id="loan_qty" type="number" min="1" step="1" required />
              </label>
              <label class="field">
                <span>ุงุณู ุงููุณุชูู</span>
                <input id="loan_person" required />
              </label>
              <label class="field">
                <span>ุฑูู ูุงุชู ุงููุณุชูู</span>
                <input id="loan_phone" inputmode="tel" />
              </label>
              <label class="field">
                <span>ุงููุณู / ุงูุฌูุฉ</span>
                <input id="loan_dept" />
              </label>
              <label class="field">
                <span>ุชุงุฑูุฎ ุงูุณูู</span>
                <input id="loan_date" type="date" required />
              </label>
              <label class="field">
                <span>ุชุงุฑูุฎ ุงูุฅุฑุฌุงุน ุงููุชููุน</span>
                <input id="loan_due" type="date" />
              </label>
            </div>
            <div class="row">
              <button class="btn primary" type="submit">ุญูุธ</button>
              <button class="btn" type="button" id="scanLoanQrBtn">ูุณุญ QR</button>
            </div>
          </form>
          <div class="toolbar">
            <input id="loanSearch" class="input" placeholder="ุจุญุซ ูู ุงูุณูููุงุช" />
          </div>
          <div class="list" id="loansList"></div>
          <div id="loanScanArea" class="scan hidden">
            <video id="loanScanVideo" playsinline></video>
            <button id="stopLoanScanBtn" class="btn danger small" type="button">ุฅููุงู ุงููุณุญ</button>
          </div>
        </div>

        <div id="route-returns" class="route hidden">
          <form id="returnForm" class="card">
            <h3>ุชุณุฌูู ุฅุฑุฌุงุน</h3>
            <div class="grid-2">
              <label class="field">
                <span>ุงูุชุงุฑูุฎ</span>
                <input id="ret_date" type="date" required />
              </label>
              <label class="field">
                <span>ุงุณู ุงูุนุชุงุฏ</span>
                <input id="ret_item" list="itemsDatalist2" required />
                <datalist id="itemsDatalist2"></datalist>
              </label>
              <label class="field">
                <span>ุงููููุฉ ุงููุฑุฌุนุฉ</span>
                <input id="ret_qty" type="number" min="0" step="1" required />
              </label>
              <label class="field">
                <span>ุงููููุฉ ุงูุชุงููุฉ</span>
                <input id="ret_damaged" type="number" min="0" step="1" value="0" />
              </label>
              <label class="field">
                <span>ุงูููุงุญุธุงุช</span>
                <input id="ret_notes" />
              </label>
            </div>
            <button class="btn primary" type="submit">ุญูุธ</button>
          </form>
          <div class="toolbar">
            <input id="returnSearch" class="input" placeholder="ุจุญุซ ูู ุงูุฅุฑุฌุงุนุงุช" />
          </div>
          <div class="list" id="returnsList"></div>
        </div>

        <div id="route-reports" class="route hidden">
          <div class="cards">
            <div class="stat">
              <div class="stat-title">ูุฌููุน ุงูุนุชุงุฏ ุงููุณูููู</div>
              <div id="stat_total_loaned" class="stat-value">0</div>
            </div>
            <div class="stat">
              <div class="stat-title">ูุฌุจ ุงุณุชุฑุฏุงุฏู ุงูููู</div>
              <div id="stat_due_today" class="stat-value">0</div>
            </div>
          </div>
          <h3>ุชูุจููุงุช ุงูุฅุฑุฌุงุน</h3>
          <div class="list" id="dueList"></div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <small class="muted">ูุณุฎุฉ ุฃูููุฉ โข ูุนูู ุฏูู ุงุชุตุงู</small>
    </footer>

    <!-- QR libraries (CDN) -->
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>

    <!-- Firebase config (user-provided) and integration (optional) -->
    <script src="firebase-config.js" defer></script>
    <script type="module" src="firebase.js"></script>
    <script src="app.js"></script>
  </body>
  <script>
    // Register Service Worker as early as possible
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }
  </script>
  
</html>


